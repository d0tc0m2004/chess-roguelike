<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess Roguelike</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- Loadout Screen -->
    <div class="loadout-screen" id="loadout-screen">
        <div class="loadout-container">
            <h1 class="loadout-title">CHESS ROGUELIKE</h1>
            <p class="loadout-subtitle">Build your deck. Conquer the gauntlet.</p>

            <div class="loadout-army">
                <div class="loadout-slot fixed">
                    <div class="slot-label">COMMANDER</div>
                    <div class="slot-piece">&#9812;</div>
                    <div class="slot-name">King</div>
                    <div class="slot-desc">Must survive</div>
                </div>

                <div class="loadout-slot selectable" data-slot="1">
                    <div class="slot-label">GUARD 1</div>
                    <div class="slot-piece" id="slot1-piece">&#9813;</div>
                    <div class="slot-select">
                        <select id="slot1-select">
                            <option value="queen">Queen</option>
                            <option value="rook">Rook</option>
                            <option value="bishop">Bishop</option>
                            <option value="knight">Knight</option>
                        </select>
                    </div>
                </div>

                <div class="loadout-slot selectable" data-slot="2">
                    <div class="slot-label">GUARD 2</div>
                    <div class="slot-piece" id="slot2-piece">&#9814;</div>
                    <div class="slot-select">
                        <select id="slot2-select">
                            <option value="rook" selected>Rook</option>
                            <option value="queen">Queen</option>
                            <option value="bishop">Bishop</option>
                            <option value="knight">Knight</option>
                        </select>
                    </div>
                </div>

                <div class="loadout-slot selectable" data-slot="3">
                    <div class="slot-label">GUARD 3</div>
                    <div class="slot-piece" id="slot3-piece">&#9816;</div>
                    <div class="slot-select">
                        <select id="slot3-select">
                            <option value="knight" selected>Knight</option>
                            <option value="queen">Queen</option>
                            <option value="rook">Rook</option>
                            <option value="bishop">Bishop</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="starter-deck-preview">
                <h3>STARTER DECK</h3>
                <div class="starter-cards" id="starter-cards-preview">
                    <!-- Filled by JS -->
                </div>
            </div>

            <button id="start-run-btn" class="start-battle-btn">BEGIN RUN</button>
        </div>
    </div>

    <!-- Pre-Battle Screen -->
    <div class="pre-battle-screen" id="pre-battle-screen" style="display: none;">
        <div class="pre-battle-container">
            <div class="battle-header">
                <span class="battle-count">BATTLE <span id="pre-battle-num">1</span>/10</span>
            </div>

            <h2 id="formation-name">THE PAWN WALL</h2>
            <p id="formation-desc">A simple line of pawns. Good for learning.</p>

            <div class="formation-info">
                <span class="info-badge difficulty">DIFFICULTY: <span id="formation-diff">1</span>/10</span>
                <span class="info-badge archetype">STYLE: <span id="formation-arch">PASSIVE</span></span>
            </div>

            <div id="formation-preview">
                <!-- Formation pieces shown here -->
            </div>

            <button id="start-battle-btn" class="start-battle-btn">SELECT CARDS</button>
        </div>
    </div>

    <!-- Card Selection Screen -->
    <div class="card-select-screen" id="card-select-screen" style="display: none;">
        <div class="card-select-container">
            <h2>SELECT YOUR HAND</h2>
            <p class="card-select-subtitle">Choose <span id="hand-size">5</span> cards for this battle</p>

            <div class="selected-cards-area">
                <h3>SELECTED (<span id="selected-count">0</span>/5)</h3>
                <div class="selected-cards" id="selected-cards">
                    <!-- Selected cards appear here -->
                </div>
            </div>

            <div class="available-cards-area">
                <h3>YOUR DECK</h3>
                <div class="available-cards" id="available-cards">
                    <!-- All deck cards shown here -->
                </div>
            </div>

            <button id="confirm-cards-btn" class="start-battle-btn" disabled>FIGHT</button>
        </div>
    </div>

    <!-- Main Game Container - Split Layout -->
    <div class="game-container" id="game-container" style="display: none;">
        <!-- LEFT: Chess Board -->
        <div class="board-column">
            <div class="board-wrapper">
                <div class="board" id="board"></div>
            </div>
        </div>

        <!-- RIGHT: Sidebar -->
        <div class="game-sidebar">
            <header class="game-header">
                <div class="run-progress">
                    <span class="battle-indicator">BATTLE <span id="current-battle">1</span>/10</span>
                </div>
                <div class="battle-info">
                    <span id="turn-indicator">YOUR TURN</span>
                    <button id="deck-btn" class="deck-btn">DECK</button>
                    <button id="help-btn" class="help-btn">?</button>
                </div>
            </header>

            <!-- Enemy Info Panel -->
            <div class="enemy-info">
                <h3 id="enemy-formation-name">ENEMY</h3>
                <span id="enemy-piece-count">PIECES: 16</span>
            </div>

            <!-- Enemy Intent -->
            <div class="enemy-intent" id="enemy-intent">
                <span>INTENT: </span>
                <span id="intent-text">---</span>
            </div>

            <!-- Player Info Panel -->
            <div class="player-info">
                <h3>YOUR ARMY</h3>
                <span id="player-piece-count">PIECES: 4</span>
            </div>

            <!-- Card Section -->
            <div class="card-section">
                <div class="card-section-header">
                    <span class="card-section-title">HAND</span>
                    <span class="cards-remaining"><span id="cards-played">0</span>/3 PLAYED</span>
                </div>
                <div class="card-hand" id="card-hand">
                    <!-- Cards inserted by JS -->
                </div>
                <div class="card-instructions" id="card-instructions"></div>
            </div>
        </div>
    </div>

    <!-- Card Reward Screen -->
    <div class="overlay reward-overlay" id="reward-overlay" style="display: none;">
        <div class="overlay-content reward-content">
            <h2>VICTORY</h2>
            <p class="reward-subtitle">Choose a card to add to your deck</p>

            <div class="reward-cards" id="reward-cards">
                <!-- 3 reward cards inserted by JS -->
            </div>

            <div class="skip-reward">
                <button id="skip-reward-btn" class="secondary-btn">SKIP</button>
            </div>
        </div>
    </div>

    <!-- Deck View Overlay -->
    <div class="overlay deck-overlay" id="deck-overlay" style="display: none;">
        <div class="overlay-content deck-content">
            <button class="close-btn" id="close-deck">&times;</button>
            <h2>YOUR DECK</h2>
            <div class="deck-full-view" id="deck-full-view">
                <!-- All cards in deck -->
            </div>
        </div>
    </div>

    <!-- Game Over Overlay -->
    <div class="overlay" id="game-over-overlay">
        <div class="overlay-content">
            <h2 id="game-over-text">VICTORY</h2>
            <p id="game-over-subtext">You defeated the enemy army.</p>
            <div class="game-over-buttons">
                <button id="restart-btn">TRY AGAIN</button>
                <button id="new-run-btn" class="secondary-btn">NEW RUN</button>
            </div>
        </div>
    </div>

    <!-- Run Complete Overlay -->
    <div class="overlay" id="run-complete-overlay" style="display: none;">
        <div class="overlay-content victory-content">
            <h2>RUN COMPLETE</h2>
            <p class="run-complete-subtitle">You conquered the gauntlet.</p>
            <div class="run-stats" id="run-stats">
                <!-- Stats filled by JS -->
            </div>
            <button id="new-run-from-complete-btn" class="start-battle-btn">NEW RUN</button>
        </div>
    </div>

    <!-- How To Play Overlay -->
    <div class="overlay" id="help-overlay">
        <div class="overlay-content help-content">
            <button class="close-btn" id="close-help">&times;</button>
            <h2>HOW TO PLAY</h2>

            <div class="help-section">
                <h3>GOAL</h3>
                <p>Complete 10 battles to win the run. Capture the enemy <span class="enemy-color">King</span> each
                    battle.</p>
            </div>

            <div class="help-section">
                <h3>ROGUELIKE ELEMENTS</h3>
                <ul>
                    <li>Start with 5 basic cards</li>
                    <li>Win battles to earn new cards</li>
                    <li>Build your deck as you progress</li>
                    <li>Enemies get harder each battle</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>HOW TO MOVE</h3>
                <ul>
                    <li>Click one of your pieces to select it</li>
                    <li>Red dots show where you can move</li>
                    <li>Red borders show enemies you can capture</li>
                    <li>Click a valid square to move there</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>CARDS</h3>
                <p>You can play up to <span class="highlight">3 cards per battle</span>. Draw 5 cards from your deck
                    each battle.</p>
                <div class="rarity-guide">
                    <span class="rarity-item common">COMMON</span>
                    <span class="rarity-item uncommon">UNCOMMON</span>
                    <span class="rarity-item rare">RARE</span>
                    <span class="rarity-item legendary">LEGENDARY</span>
                </div>
            </div>

            <div class="help-section">
                <h3>ENEMY INTENT</h3>
                <p>The red highlighted square shows where the enemy <span class="highlight">plans to move</span>. Use
                    this to plan your strategy.</p>
            </div>

            <button id="start-game-btn" class="start-btn">GOT IT</button>
        </div>
    </div>

    <!-- Game Systems (must load in order) -->
    <script src="js/cards.js?v=2"></script>
    <script src="js/formations.js?v=2"></script>
    <script src="js/ai-system.js?v=2"></script>
    <script src="js/chess-ai.js?v=2"></script>
    <script src="game.js?v=2"></script>
</body>

</html>